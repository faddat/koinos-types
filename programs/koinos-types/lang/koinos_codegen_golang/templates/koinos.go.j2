{%- macro vector(tref) -%}
[]{{typeref(tref["targs"][0])}}
{%- endmacro -%}

{%- macro template(targs) -%}
<
{%- for arg in targs -%}
{{arg["name"][-1]}}{{"," if not loop.last}}
{%- endfor -%}
>
{%- endmacro -%}

{%- macro typeref(tref) -%}
{%- if tref["name"][-1] == "vector" -%}{{vector(tref)}}
{%- else -%}
{{tref["name"][-1]}}
{%- if tref["targs"] is not none -%}{{template(tref["targs"])}}{%- endif -%}
{%- endif -%}
{%- endmacro -%}

{%- for name, decl in decls_by_name.items() -%}
{% if decl["info"]["type"] == "Struct" %}
// {{decl}}
type {{decl["name"]}} struct {
{% if decl["fields"]|length > 0 -%}
{%- for field in decl["fields"] %}{{field["name"]}} {{typeref(field["tref"])}}
{% endfor %}
{%- endif -%}
}
{% endif -%}
{% endfor %}
